# 도커 오케스트레이터가 재시작과 복제 프로세스를 하게 하라

<br/><br/>

### 한 문단 설명

쿠버네티스와 같은 도커 런타임 오케스트레이터는 컨테이너의 건강과 위치에 대한 결정을 내림에 있어 탁월하다: 그들은 이러한 결정을 할 때 컨테이너의 수를 최대화 하고, 그들을 존 전역에서 균형화하고, 클러스터 요인들을 고려하는 것에 심혈을 기울일 것이다. 말 할 필요도 없이, 그들은 실패하는 프로세스(즉, 컨테이너들)를 식별하고 그들을 올바른 곳에서 재시작한다. 누군가는 CPU 이용을 위해 노드 프로세스를 복제하거나 실패(즉, 클러스터 모듈, PM2) 시 프로세스를 재시작하기 위해 커스텀 코드나 툴을 사용하고싶은 유혹을 느낄테지만 이러한 로컬 툴들은 관점(perspective)과 클러스터 레벨에서 사용 가능한 데이터를 가지고 있지 않다. 예를 들어, 인스턴스 자원이 3개의 컨테이너와 2개의 주어진 리젼이나 존을 호스트할 수 있을 경우, 쿠버네티스는 컨테이너를 존 전역에 퍼트리는 것에 주의를 기한다. 이런 방법으로, 존 혹은 리젼의 실패 경우 앱은 살아남을 것이다. 반대로 프로세스를 재시작하기위해 로컬툴들을 사용한다면 도커 오케스트레이터는 에러에 대해 알지 못하고, 컨테이너를 새로운 인스턴스 혹은 존으로 재배치하는 등의 사려깊은 결정들 내리지 못한다.

<br/><br/>

### 코드 예시 – 중간자 툴 없이 직접 Node.js를 불러와라

<details>

<summary><strong>Dockerfile</strong></summary>

```dockerfile
FROM node:12-slim

# 빌드 로직이 오는 곳

CMD ["node", "index.js"]
```

</details>

<br/><br/>

### 안티 패턴 코드 예시 - 프로세스 매니저를 이용하는 경우

<details>

<summary><strong>Dockerfile</strong></summary>

```dockerfile
FROM node:12-slim

# 빌드 로직이 오는 곳

CMD ["pm2-runtime", "index.js"]
```

</details>
